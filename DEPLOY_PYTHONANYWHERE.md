# Руководство по развертыванию на PythonAnywhere

PythonAnywhere — это облачный сервис, который предоставляет онлайн-среду для программирования на Python. Бесплатный тариф позволяет запускать ваши приложения, но с некоторыми ограничениями.

## Подготовка к развертыванию

1. Зарегистрируйтесь на [PythonAnywhere](https://www.pythonanywhere.com/) или войдите в существующий аккаунт.

## Загрузка проекта

### Вариант 1: Клонирование из GitHub
Если ваш код размещен на GitHub:

1. Откройте консоль в PythonAnywhere
2. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/ваш_аккаунт/psi-help24-bot.git
   ```

### Вариант 2: Загрузка ZIP-архива
Если ваш код не на GitHub:

1. Упакуйте проект в ZIP-архив
2. Загрузите его через интерфейс файлов PythonAnywhere
3. Распакуйте архив в консоли:
   ```bash
   unzip psi-help24-bot.zip -d ~/psi-help24-bot
   ```

## Настройка виртуального окружения

1. Создайте виртуальное окружение:
   ```bash
   mkvirtualenv --python=/usr/bin/python3.10 psi-help-env
   ```

2. Активируйте виртуальное окружение:
   ```bash
   workon psi-help-env
   ```

3. Перейдите в директорию проекта:
   ```bash
   cd ~/psi-help24-bot
   ```

4. Установите зависимости:
   ```bash
   pip install -r requirements-bot.txt
   pip install flask python-dotenv
   ```

## Настройка переменных окружения

1. Создайте файл `.env` в корневой директории проекта:
   ```bash
   nano ~/psi-help24-bot/.env
   ```

2. Добавьте в него следующие строки, заменив значения на ваши:
   ```
   TELEGRAM_TOKEN=ваш_токен_телеграм_бота
   GEMINI_API_KEY=ваш_ключ_api_gemini
   ```

3. Сохраните файл: Ctrl+O, затем Enter, затем Ctrl+X

## Настройка Flask-приложения

1. На странице "Web" в PythonAnywhere нажмите "Add a new web app"
2. Выберите "Manual configuration" (не "Flask")
3. Выберите Python 3.10
4. На странице настройки:
   - В поле "Code:" укажите путь к вашему проекту (например, `/home/вашлогин/psi-help24-bot`)
   - В поле "WSGI configuration file:" нажмите на ссылку для редактирования
   - Замените содержимое на содержимое файла `wsgi.py` из вашего проекта
   - Сохраните изменения

5. В разделе "Virtualenv:" укажите путь к виртуальному окружению:
   ```
   /home/вашлогин/.virtualenvs/psi-help-env
   ```

6. В разделе "Static files:" можно оставить пустым, так как у нас нет статических файлов

## Настройка задачи для запуска бота

Чтобы бот работал постоянно, несмотря на ограничения бесплатного тарифа PythonAnywhere:

1. На странице "Tasks" в PythonAnywhere создайте новую ежедневную задачу
2. В поле "Command:" укажите полный путь к скрипту запуска:
   ```bash
   bash /home/вашлогин/psi-help24-bot/run_bot.sh
   ```
3. Установите время выполнения (например, 7:00 UTC)

## Запуск бота вручную

1. Откройте консоль в PythonAnywhere
2. Активируйте виртуальное окружение:
   ```bash
   workon psi-help-env
   ```
3. Перейдите в директорию проекта:
   ```bash
   cd ~/psi-help24-bot
   ```
4. Запустите бота:
   ```bash
   python main.py
   ```

## Обход ограничений бесплатного тарифа

На бесплатном тарифе PythonAnywhere ваше приложение может "засыпать" при отсутствии активности. Для поддержания работы бота:

1. Используйте веб-интерфейс Flask для управления ботом, который мы настроили в проекте
2. Настройте внешний сервис для периодического пинга вашего Flask-приложения
   - Например, используйте [UptimeRobot](https://uptimerobot.com/) для отправки HTTP-запросов каждые 5 минут
   - Настройте мониторинг URL вашего приложения с путем `/ping`: `https://вашлогин.pythonanywhere.com/ping`

## Проверка работы

Когда все настроено, откройте свой сайт в браузере:
```
https://вашлогин.pythonanywhere.com
```

Вы должны увидеть панель управления ботом, где можно проверить его статус и перезапустить при необходимости.

Для проверки самого бота, откройте Telegram и найдите своего бота по имени или юзернейму, затем отправьте команду `/start`.

## Устранение проблем

Если бот не работает должным образом:

1. Проверьте логи ошибок в консоли PythonAnywhere
2. Убедитесь, что все переменные окружения настроены правильно
3. Перезапустите Flask-приложение через панель управления
4. Попробуйте перезапустить бота через веб-интерфейс

## Лимиты бесплатного тарифа PythonAnywhere

Обратите внимание на следующие ограничения бесплатного тарифа:
- Выполнение процессов ограничено 100 секундами CPU времени
- Сайт может "засыпать" при отсутствии трафика
- Для постоянной работы требуется внешний пинг-сервис
- Консоли закрываются автоматически после нескольких дней неактивности