# Инструкция по развертыванию бота на Fly.io

## Предварительные требования
1. Создайте аккаунт на [Fly.io](https://fly.io/app/sign-up) (бесплатный план)
2. Установите [Flyctl](https://fly.io/docs/hands-on/install-flyctl/) - консольный инструмент Fly.io

## Шаги по развертыванию

### 1. Авторизация и настройка

```bash
# Войдите в аккаунт Fly.io
fly auth login

# (Опционально) Если файл fly.toml еще не создан, инициализируйте приложение
# fly launch
```

### 2. Настройка секретов (переменных окружения)

```bash
# Установите переменные окружения для API ключей
fly secrets set TELEGRAM_TOKEN=ваш_токен_телеграм_бота
fly secrets set GEMINI_API_KEY=ваш_ключ_api_gemini
```

### 3. Деплой приложения

```bash
# Разверните приложение на Fly.io
fly deploy

# Если это первый деплой и ранее не запускали `fly launch`, 
# выберите регион, ближайший к вашим пользователям
```

### 4. Проверка статуса и логов

```bash
# Проверьте статус приложения
fly status

# Посмотрите логи в реальном времени
fly logs

# Для подключения к оболочке (если нужно)
fly ssh console
```

## Управление приложением

### Перезапуск приложения

```bash
fly apps restart
```

### Масштабирование (Примечание: требуется платный план для нескольких экземпляров)

```bash
# Проверить текущие масштабы
fly scale show

# Изменить размер VM (на бесплатном плане доступны только машины shared-cpu-1x)
fly scale vm shared-cpu-1x
```

### Обновление приложения

Для обновления кода просто внесите изменения и выполните:

```bash
fly deploy
```

## Бесплатный план Fly.io

Бесплатный план Fly.io включает:
- 3 виртуальные машины shared-cpu-1x (с 256MB RAM)
- 2340 машино-часов в месяц (достаточно для непрерывной работы машины 24/7)
- 3GB постоянного хранилища
- 160GB исходящего трафика в месяц

Эти ресурсы более чем достаточны для работы Telegram-бота.

## Важные замечания

1. Ваш бот будет работать непрерывно 24/7 на бесплатном плане, в отличие от Heroku.
2. При достижении лимитов бесплатного плана начинается автоматическое списание средств - следите за использованием ресурсов.
3. Для настройки собственного домена вместо subdomain.fly.dev требуется платный план.

## Диагностика распространенных проблем

- **Ошибка при деплое**: Убедитесь, что Docker-образ собирается корректно. Проверьте файл `requirements-fly.txt`.
- **Бот не отвечает**: Проверьте логи через `fly logs` и убедитесь, что переменные окружения настроены правильно.
- **Высокая загрузка CPU**: Возможно стоит рассмотреть машину большего размера (требует платного плана).